{
    "collab_server" : "",
    "contents" : "################################################################################\n# title         : 02 - SimCastMeta.R;\n# purpose       : Create a SimCastMeta GAM model for a daily or monthly time-step;\n# producer      : prepared by A. Sparks;\n# last update   : in Los Baños, Laguna, Jan 2016;\n# inputs        : blight unit values as calculated in SimCast_Blight_Units.R;\n# outputs       : GAM suitable for predicting late blight risk using daily T and RH data\n#                 graphs illustrating fit of the model;\n# remarks       : this model is documented in:\n#                 Sparks, A. H., Forbes, G. A., Hijmans, R. J., & Garrett, K. A. (2011). \n#                 A metamodeling framework for extending the application domain of process-based \n#                 ecological models. Ecosphere, 2(8), art90. doi:10.1890/ES11-00128.1\n# Licence:      : GPL2;\n################################################################################\n\n# Load libraries ---------------------------------------------------------------\nrequire(\"mgcv\")\nrequire(\"ggplot2\")\nrequire(\"ggthemes\")\nrequire(\"plyr\")\nrequire(\"readr\")\nrequire(\"rgl\")\n\n# Load data --------------------------------------------------------------------\n\n# Use only ONE of the following tables at a time\n\n# Data for daily models\n# Create a SUSCEPTIBLE model with this data for daily weather data\n#blight_units <- read_tsv(\"Cache/Blight Units/daily_susceptible_blight_units.txt\")\n\n# Create a RESISTANT cultivar model with this data for daily weather data\n#blight_units <- read_tsv(\"Cache/Blight Units/daily_resistant_blight_units.txt\")\n\n# Data for monthly models \n# Create a SUSCEPTIBLE model with this data for monthly weather data\nblight_units <- read_tsv(\"Cache/Blight Units/monthly_susceptible_blight_units.txt\")\n\n# Create a RESISTANT model with this data for monthly weather data\n#blight_units <- read_tsv(\"Cache/Blight Units/monthly_resistant_blight_units.txt\")\n\n# Data munging -----------------------------------------------------------------\n# Split the weather data into two parts for construction and testing\n# we used six years of HUSWO data to generate the values, so split at 1992/1993\nconstruction_data <- subset(blight_units, Year <= 1992)\n\n# Model validation data\ntesting_data <- subset(blight_units, Year >= 1993)\n\n# Modelling --------------------------------------------------------------------\n# A k of 150 generated the most biologically believable model with the daily data we used based on GCV score \n# higher values indicate a \"better fitting\" model, but an examination of the 3D surface indicates otherwise\n\ngam_predict <- gam(Blight~s(C, RH, k = 150), data = construction_data)\nsummary(gam_predict)\n\n# Test the model\ntesting_prediction <- predict.gam(gam_predict, testing_data)\n\n# Some values fall below 0, this cannot happen in reality, so set negative values to 0\ntesting_prediction[testing_prediction < 0] <- 0\n\n# check the correlation between the orginal and the predicted\ncor(testing_data$Blight, testing_prediction)\n\n# Model visualisation ----------------------------------------------------------\n\ntest_plot <- as.data.frame(cbind(testing_data$Blight, testing_prediction))\ncolnames(test_plot) <- c(\"blight\", \"blight_prediction\")\n\n# Graphs\n\nvis.gam(\n  gam_predict,\n  theta = -45,\n  phi = 35,\n  ticktype = \"detailed\",\n  main = \"\",\n  zlab = \"Predicted Blight Units\",\n  ylab = \"Relative Humidity (%)\",\n  xlab = \"Temperature (°C)\",\n  shade = 0.65,\n  zlim = c(0, 8),\n  cex.lab = 0.8,\n  cex.axis = 0.8\n)\n\n# Boxplots with 1:1 line (dashed) and fitted line (blue)\np <- ggplot(test_plot, aes(y = blight_prediction, x = blight))\n\np + geom_tufteboxplot(outlier.shape = NA, \n                      aes(group = round_any(blight, 0.1, floor))) + \n  geom_smooth(method = \"lm\", se = FALSE, formula = y ~ x) + \n  geom_abline(intercept = 0, slope = 1, linetype = \"dashed\") + \n  scale_x_continuous(\"Blight Units Predicted by SimCast\") + \n  scale_y_continuous(\"Blight Units Predicted by SimCast_Meta\") +\n  theme_tufte() +\n  ggtitle(\"Predicted Blight Units for a Susceptible Cultivar\")\n\n# eos\n",
    "created" : 1466734884913.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2877344484",
    "id" : "417F93F2",
    "lastKnownWriteTime" : 1467181127,
    "last_content_update" : 1467181127899,
    "path" : "~/Development/Global-Late-Blight-MetaModelling/01 - Models/02 - SimCastMeta.R",
    "project_path" : "01 - Models/02 - SimCastMeta.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}